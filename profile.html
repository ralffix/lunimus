<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Profile Settings</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <nav class="topbar">
    <a href="index.html">Home</a>
    <a href="mygames.html">My Games</a>
    <a href="buygames.html">Buy Games</a>
    <a href="other progekts.html">Other Projects</a>
    <a href="server.html">Minecraft Server</a>
    <a href="about me.html">About Me</a>
      <a href="login.html" id="login-link">Sign In / Log In</a>
  </nav>    

  <main class="login-container">
    <h2>Profile Settings</h2>
    <div id="user-email"></div>

    <h3>Change Password</h3>
    <input type="password" id="new-password" placeholder="New Password" />
    <button id="change-password-btn">Change Password</button>

    <h3>Delete Account</h3>
    <button id="delete-account-btn" style="background-color: #ff4444; color: white;">
      Delete My Account
    </button>

    <div id="message"></div>
  </main>

  <script src="supabase-config.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    const supabaseClient = window.supabase.createClient(
      window.SUPABASE_URL,
      window.SUPABASE_ANON_KEY
    );

    const messageDiv = document.getElementById("message");
    const loginLink = document.getElementById("login-link");

    // Update login link if user is logged in
    supabaseClient.auth.getSession().then(({ data: { session } }) => {
      if (session && session.user) {
        loginLink.href = "profile.html";
        loginLink.textContent = "Profile";
        document.getElementById("user-email").textContent = "Logged in as: " + session.user.email;
      } else {
        // Not logged in â€” redirect to login
        window.location.href = "login.html";
      }
    });

    // Show a message
    function showMessage(msg, isError = false) {
      messageDiv.innerText = msg;
      messageDiv.style.color = isError ? "red" : "lightgreen";
    }

    // Change password
    async function changePassword() {
      const newPassword = document.getElementById("new-password").value;
      if (!newPassword) {
        showMessage("Please enter a new password.", true);
        return;
      }

      const { error } = await supabaseClient.auth.updateUser({
        password: newPassword,
      });

      if (error) {
        showMessage("Error: " + error.message, true);
      } else {
        showMessage("Password changed successfully.");
      }
    }

    // "Delete" account (requires backend logic)
    function deleteAccount() {
      showMessage("Account deletion requires backend support. Please contact support.", true);

      // Optional: log out the user
      supabaseClient.auth.signOut().then(() => {
        window.location.href = "index.html";
      });
    }

    // Button handlers
    document.getElementById("change-password-btn").addEventListener("click", changePassword);
    document.getElementById("delete-account-btn").addEventListener("click", deleteAccount);
  </script>
</body>
</html>
